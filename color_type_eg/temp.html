
<style>
body                { margin: 0; }
pre                 { color: #DCDCCC; background: #3F3F3F; font-size: 22px; padding: 0.4em; }

.comment            { color: #7F9F7F; }
.string             { color: #CC9393; }
.function           { color: #93E0E3; }
.parameter          { color: #94BFF3; }
.builtin            { color: #DD6718; }
.text               { color: #DCDCCC; }
.attribute          { color: #94BFF3; }
.literal            { color: #BFEBBF; }
.macro              { color: #94BFF3; }
.variable           { color: #DCDCCC; }
.variable\.mut     { color: #DCDCCC; text-decoration: underline; }

.keyword            { color: #F0DFAF; }
.keyword\.unsafe   { color: #DFAF8F; }
.keyword\.control  { color: #F0DFAF; font-weight: bold; }
</style>
<pre><code><span class="comment">//! FIXME: write short doc here</span>

<span class="keyword">mod</span> <span class="function">analysis_stats</span>;
<span class="keyword">mod</span> <span class="function">analysis_bench</span>;
<span class="keyword">mod</span> <span class="function">help</span>;

<span class="keyword">use</span> <span class="text">std</span>::{<span class="text">error</span>::<span class="text">Error</span>, <span class="text">fmt</span>::<span class="text">Write</span>, <span class="text">io</span>::<span class="text">Read</span>};

<span class="keyword">use</span> <span class="text">flexi_logger</span>::<span class="text">Logger</span>;
<span class="keyword">use</span> <span class="text">pico_args</span>::<span class="text">Arguments</span>;
<span class="keyword">use</span> <span class="text">ra_ide_api</span>::{<span class="text">file_structure</span>, <span class="text">Analysis</span>};
<span class="keyword">use</span> <span class="text">ra_prof</span>::<span class="text">profile</span>;
<span class="keyword">use</span> <span class="text">ra_syntax</span>::{<span class="text">AstNode</span>, <span class="text">SourceFile</span>};

<span class="keyword">type</span> <span class="type">Result</span>&lt;<span class="type">T</span>&gt; = <span class="text">std</span>::<span class="text">result</span>::<span class="text">Result</span>&lt;<span class="text">T</span>, <span class="text">Box</span>&lt;<span class="keyword">dyn</span> <span class="text">Error</span> + <span class="text">Send</span> + <span class="text">Sync</span>&gt;&gt;;

<span class="attribute">#</span><span class="attribute">[</span><span class="attribute">derive</span><span class="attribute">(</span><span class="attribute">Clone</span><span class="attribute">,</span><span class="attribute"> </span><span class="attribute">Copy</span><span class="attribute">)</span><span class="attribute">]</span>
<span class="keyword">pub</span> <span class="keyword">enum</span> <span class="type">Verbosity</span> {
    <span class="function">Verbose</span>,
    <span class="function">Normal</span>,
    <span class="function">Quiet</span>,
}

<span class="keyword">impl</span> <span class="type">Verbosity</span> {
    <span class="keyword">fn</span> <span class="function">is_verbose</span>(&<span class="keyword">self</span>) -&gt; <span class="type">bool</span> {
        <span class="keyword.control">match</span> <span class="keyword">self</span> {
            <span class="type">Verbosity</span>::<span class="constant">Verbose</span> =&gt; <span class="keyword">true</span>,
            _ =&gt; <span class="keyword">false</span>,
        }
    }
}

<span class="keyword">fn</span> <span class="function">main</span>() -&gt; <span class="type">Result</span>&lt;()&gt; {
    <span class="text">Logger</span>::<span class="text">with_env_or_str</span>(<span class="string">"error"</span>).<span class="text">start</span>()?;

    <span class="keyword">let</span> <span class="variable" data-binding-hash="499428303840513232" style="color: hsl(173,92%,52%);">subcommand</span> = <span class="keyword.control">match</span> <span class="text">std</span>::<span class="text">env</span>::<span class="text">args_os</span>().<span class="text">nth</span>(<span class="literal">1</span>) {
        <span class="variable" data-binding-hash="1745581853168918314" style="color: hsl(8,65%,80%);">None</span> =&gt; {
            <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::GLOBAL_HELP);
            <span class="keyword.control">return</span> <span class="text">Ok</span>(());
        }
        <span class="text">Some</span>(<span class="variable" data-binding-hash="17622874386840607531" style="color: hsl(261,65%,82%);">s</span>) =&gt; <span class="variable" data-binding-hash="17622874386840607531" style="color: hsl(261,65%,82%);">s</span>,
    };
    <span class="keyword">let</span> <span class="keyword">mut</span> <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span> = <span class="text">Arguments</span>::<span class="text">from_vec</span>(<span class="text">std</span>::<span class="text">env</span>::<span class="text">args_os</span>().<span class="text">skip</span>(<span class="literal">2</span>).<span class="text">collect</span>());

    <span class="keyword.control">match</span> &*<span class="variable" data-binding-hash="499428303840513232" style="color: hsl(173,92%,52%);">subcommand</span>.<span class="text">to_string_lossy</span>() {
        <span class="string">"parse"</span> =&gt; {
            <span class="keyword.control">if</span> <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-h"</span>, <span class="string">"--help"</span>]) {
                <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::PARSE_HELP);
                <span class="keyword.control">return</span> <span class="text">Ok</span>(());
            }
            <span class="keyword">let</span> <span class="variable" data-binding-hash="8177489474621688073" style="color: hsl(309,65%,43%);">no_dump</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>(<span class="string">"--no-dump"</span>);
            <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">finish</span>().<span class="text">or_else</span>(<span class="function">handle_extra_flags</span>)?;

            <span class="keyword">let</span> <span class="variable" data-binding-hash="10832612813523020921" style="color: hsl(333,51%,88%);">_p</span> = <span class="text">profile</span>(<span class="string">"parsing"</span>);
            <span class="keyword">let</span> <span class="variable" data-binding-hash="18133635313489679134" style="color: hsl(347,55%,59%);">file</span> = <span class="function">file</span>()?;
            <span class="keyword.control">if</span> !<span class="variable" data-binding-hash="8177489474621688073" style="color: hsl(309,65%,43%);">no_dump</span> {
                <span class="macro">println</span><span class="macro">!</span>(<span class="string">"{:#?}"</span>, file.syntax());
            }
            <span class="text">std</span>::<span class="text">mem</span>::<span class="text">forget</span>(<span class="variable" data-binding-hash="18133635313489679134" style="color: hsl(347,55%,59%);">file</span>);
        }
        <span class="string">"symbols"</span> =&gt; {
            <span class="keyword.control">if</span> <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-h"</span>, <span class="string">"--help"</span>]) {
                <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::SYMBOLS_HELP);
                <span class="keyword.control">return</span> <span class="text">Ok</span>(());
            }
            <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">finish</span>().<span class="text">or_else</span>(<span class="function">handle_extra_flags</span>)?;
            <span class="keyword">let</span> <span class="variable" data-binding-hash="15146314061786579229" style="color: hsl(132,69%,50%);">file</span> = <span class="function">file</span>()?;
            <span class="keyword.control">for</span> <span class="variable" data-binding-hash="17220992762358653836" style="color: hsl(133,88%,44%);">s</span> <span class="keyword">in</span> <span class="text">file_structure</span>(&<span class="variable" data-binding-hash="15146314061786579229" style="color: hsl(132,69%,50%);">file</span>) {
                <span class="macro">println</span><span class="macro">!</span>(<span class="string">"{:?}"</span>, s);
            }
        }
        <span class="string">"highlight"</span> =&gt; {
            <span class="keyword.control">if</span> <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-h"</span>, <span class="string">"--help"</span>]) {
                <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::HIGHLIGHT_HELP);
                <span class="keyword.control">return</span> <span class="text">Ok</span>(());
            }
            <span class="keyword">let</span> <span class="variable" data-binding-hash="12060600482788150347" style="color: hsl(155,71%,60%);">rainbow_opt</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-r"</span>, <span class="string">"--rainbow"</span>]);
            <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">finish</span>().<span class="text">or_else</span>(<span class="function">handle_extra_flags</span>)?;
            <span class="keyword">let</span> (<span class="variable" data-binding-hash="6417219022492766982" style="color: hsl(61,91%,59%);">analysis</span>, <span class="variable" data-binding-hash="10824936732197091658" style="color: hsl(200,67%,47%);">file_id</span>) = <span class="text">Analysis</span>::<span class="text">from_single_file</span>(<span class="function">read_stdin</span>()?);
            <span class="keyword">let</span> <span class="variable" data-binding-hash="11392071574134366477" style="color: hsl(275,90%,78%);">html</span> = <span class="variable" data-binding-hash="6417219022492766982" style="color: hsl(61,91%,59%);">analysis</span>.<span class="text">highlight_as_html</span>(<span class="variable" data-binding-hash="10824936732197091658" style="color: hsl(200,67%,47%);">file_id</span>, <span class="variable" data-binding-hash="12060600482788150347" style="color: hsl(155,71%,60%);">rainbow_opt</span>).<span class="text">unwrap</span>();
            <span class="macro">println</span><span class="macro">!</span>(<span class="string">"{}"</span>, html);
        }
        <span class="string">"analysis-stats"</span> =&gt; {
            <span class="keyword.control">if</span> <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-h"</span>, <span class="string">"--help"</span>]) {
                <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::ANALYSIS_STATS_HELP);
                <span class="keyword.control">return</span> <span class="text">Ok</span>(());
            }
            <span class="keyword">let</span> <span class="variable" data-binding-hash="12611783906543801203" style="color: hsl(323,52%,84%);">verbosity</span> = <span class="keyword.control">match</span> (
                <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-v"</span>, <span class="string">"--verbose"</span>]),
                <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-q"</span>, <span class="string">"--quiet"</span>]),
            ) {
                (<span class="keyword">false</span>, <span class="keyword">false</span>) =&gt; <span class="type">Verbosity</span>::<span class="constant">Normal</span>,
                (<span class="keyword">false</span>, <span class="keyword">true</span>) =&gt; <span class="type">Verbosity</span>::<span class="constant">Quiet</span>,
                (<span class="keyword">true</span>, <span class="keyword">false</span>) =&gt; <span class="type">Verbosity</span>::<span class="constant">Verbose</span>,
                (<span class="keyword">true</span>, <span class="keyword">true</span>) =&gt; <span class="text">Err</span>(<span class="string">"Invalid flags: -q conflicts with -v"</span>)?,
            };
            <span class="keyword">let</span> <span class="variable" data-binding-hash="7747796310646909654" style="color: hsl(107,59%,54%);">memory_usage</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>(<span class="string">"--memory-usage"</span>);
            <span class="keyword">let</span> <span class="variable" data-binding-hash="17799722209152553782" style="color: hsl(40,69%,62%);">only</span>: <span class="text">Option</span>&lt;<span class="text">String</span>&gt; = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">opt_value_from_str</span>([<span class="string">"-o"</span>, <span class="string">"--only"</span>])?;
            <span class="keyword">let</span> <span class="variable" data-binding-hash="18188863633102681520" style="color: hsl(240,42%,68%);">path</span> = {
                <span class="keyword">let</span> <span class="keyword">mut</span> <span class="variable.mut" data-binding-hash="15066342985227534326" style="color: hsl(258,60%,42%);">trailing</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">free</span>()?;
                <span class="keyword.control">if</span> <span class="variable.mut" data-binding-hash="15066342985227534326" style="color: hsl(258,60%,42%);">trailing</span>.<span class="text">len</span>() != <span class="literal">1</span> {
                    <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::ANALYSIS_STATS_HELP);
                    <span class="text">Err</span>(<span class="string">"Invalid flags"</span>)?;
                }
                <span class="variable.mut" data-binding-hash="15066342985227534326" style="color: hsl(258,60%,42%);">trailing</span>.<span class="text">pop</span>().<span class="text">unwrap</span>()
            };
            <span class="text">analysis_stats</span>::<span class="text">run</span>(
                <span class="variable" data-binding-hash="12611783906543801203" style="color: hsl(323,52%,84%);">verbosity</span>,
                <span class="variable" data-binding-hash="7747796310646909654" style="color: hsl(107,59%,54%);">memory_usage</span>,
                <span class="variable" data-binding-hash="18188863633102681520" style="color: hsl(240,42%,68%);">path</span>.<span class="text">as_ref</span>(),
                <span class="variable" data-binding-hash="17799722209152553782" style="color: hsl(40,69%,62%);">only</span>.<span class="text">as_ref</span>().<span class="text">map</span>(<span class="text">String</span>::<span class="text">as_ref</span>),
            )?;
        }
        <span class="string">"analysis-bench"</span> =&gt; {
            <span class="keyword.control">if</span> <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-h"</span>, <span class="string">"--help"</span>]) {
                <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::ANALYSIS_BENCH_HELP);
                <span class="keyword.control">return</span> <span class="text">Ok</span>(());
            }
            <span class="keyword">let</span> <span class="variable" data-binding-hash="15301498430159054717" style="color: hsl(123,57%,66%);">verbose</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">contains</span>([<span class="string">"-v"</span>, <span class="string">"--verbose"</span>]);
            <span class="keyword">let</span> <span class="variable" data-binding-hash="198835288065533350" style="color: hsl(38,86%,76%);">path</span>: <span class="text">String</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">opt_value_from_str</span>(<span class="string">"--path"</span>)?.<span class="text">unwrap_or_default</span>();
            <span class="keyword">let</span> <span class="variable" data-binding-hash="2295181705970706140" style="color: hsl(167,64%,83%);">highlight_path</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">opt_value_from_str</span>(<span class="string">"--highlight"</span>)?;
            <span class="keyword">let</span> <span class="variable" data-binding-hash="14103674434535837436" style="color: hsl(322,85%,86%);">complete_path</span> = <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">opt_value_from_str</span>(<span class="string">"--complete"</span>)?;
            <span class="keyword.control">if</span> <span class="variable" data-binding-hash="2295181705970706140" style="color: hsl(167,64%,83%);">highlight_path</span>.<span class="text">is_some</span>() && <span class="variable" data-binding-hash="14103674434535837436" style="color: hsl(322,85%,86%);">complete_path</span>.<span class="text">is_some</span>() {
                <span class="macro">panic</span><span class="macro">!</span>(<span class="string">"either --highlight or --complete must be set, not both"</span>)
            }
            <span class="keyword">let</span> <span class="variable" data-binding-hash="4155430993874628995" style="color: hsl(353,82%,74%);">op</span> = <span class="keyword.control">if</span> <span class="keyword">let</span> <span class="text">Some</span>(<span class="variable" data-binding-hash="3067130077770385801" style="color: hsl(246,54%,44%);">path</span>) = <span class="variable" data-binding-hash="2295181705970706140" style="color: hsl(167,64%,83%);">highlight_path</span> {
                <span class="keyword">let</span> <span class="variable" data-binding-hash="5784900319402717907" style="color: hsl(194,58%,75%);">path</span>: <span class="text">String</span> = <span class="variable" data-binding-hash="5784900319402717907" style="color: hsl(194,58%,75%);">path</span>;
                <span class="text">analysis_bench</span>::<span class="text">Op</span>::<span class="text">Highlight</span> { <span class="text">path</span>: <span class="variable" data-binding-hash="5784900319402717907" style="color: hsl(194,58%,75%);">path</span>.<span class="text">into</span>() }
            } <span class="keyword.control">else</span> <span class="keyword.control">if</span> <span class="keyword">let</span> <span class="text">Some</span>(<span class="variable" data-binding-hash="3807877775359575375" style="color: hsl(47,55%,76%);">path_line_col</span>) = <span class="variable" data-binding-hash="14103674434535837436" style="color: hsl(322,85%,86%);">complete_path</span> {
                <span class="keyword">let</span> <span class="variable" data-binding-hash="4230876285254922639" style="color: hsl(75,43%,73%);">path_line_col</span>: <span class="text">String</span> = <span class="variable" data-binding-hash="4230876285254922639" style="color: hsl(75,43%,73%);">path_line_col</span>;
                <span class="keyword">let</span> (<span class="variable" data-binding-hash="17965835909299255605" style="color: hsl(275,66%,89%);">path_line</span>, <span class="variable" data-binding-hash="2811013509349124818" style="color: hsl(216,68%,74%);">column</span>) = <span class="function">rsplit_at_char</span>(<span class="variable" data-binding-hash="4230876285254922639" style="color: hsl(75,43%,73%);">path_line_col</span>.<span class="text">as_str</span>(), <span class="literal">':'</span>)?;
                <span class="keyword">let</span> (<span class="variable" data-binding-hash="10894706953684897608" style="color: hsl(114,62%,88%);">path</span>, <span class="variable" data-binding-hash="10129346907633217308" style="color: hsl(280,53%,53%);">line</span>) = <span class="function">rsplit_at_char</span>(<span class="variable" data-binding-hash="17965835909299255605" style="color: hsl(275,66%,89%);">path_line</span>, <span class="literal">':'</span>)?;
                <span class="text">analysis_bench</span>::<span class="text">Op</span>::<span class="text">Complete</span> {
                    <span class="text">path</span>: <span class="variable" data-binding-hash="10894706953684897608" style="color: hsl(114,62%,88%);">path</span>.<span class="text">into</span>(),
                    <span class="text">line</span>: <span class="variable" data-binding-hash="10129346907633217308" style="color: hsl(280,53%,53%);">line</span>.<span class="text">parse</span>()?,
                    <span class="text">column</span>: <span class="variable" data-binding-hash="2811013509349124818" style="color: hsl(216,68%,74%);">column</span>.<span class="text">parse</span>()?,
                }
            } <span class="keyword.control">else</span> {
                <span class="macro">panic</span><span class="macro">!</span>(<span class="string">"either --highlight or --complete must be set"</span>)
            };
            <span class="variable.mut" data-binding-hash="4147548833128541011" style="color: hsl(354,71%,80%);">matches</span>.<span class="text">finish</span>().<span class="text">or_else</span>(<span class="function">handle_extra_flags</span>)?;
            <span class="text">analysis_bench</span>::<span class="text">run</span>(<span class="variable" data-binding-hash="15301498430159054717" style="color: hsl(123,57%,66%);">verbose</span>, <span class="variable" data-binding-hash="10894706953684897608" style="color: hsl(114,62%,88%);">path</span>.<span class="text">as_ref</span>(), <span class="variable" data-binding-hash="4155430993874628995" style="color: hsl(353,82%,74%);">op</span>)?;
        }
        _ =&gt; <span class="macro">eprintln</span><span class="macro">!</span>(<span class="string">"{}"</span>, help::GLOBAL_HELP),
    }
    <span class="text">Ok</span>(())
}

<span class="keyword">fn</span> <span class="function">handle_extra_flags</span>(<span class="variable" data-binding-hash="1056301860844129919" style="color: hsl(263,90%,50%);">e</span>: <span class="text">pico_args</span>::<span class="text">Error</span>) -&gt; <span class="type">Result</span>&lt;()&gt; {
    <span class="keyword.control">if</span> <span class="keyword">let</span> <span class="text">pico_args</span>::<span class="text">Error</span>::<span class="text">UnusedArgsLeft</span>(<span class="variable" data-binding-hash="5908644082858828157" style="color: hsl(277,48%,78%);">flags</span>) = <span class="variable" data-binding-hash="1056301860844129919" style="color: hsl(263,90%,50%);">e</span> {
        <span class="keyword">let</span> <span class="keyword">mut</span> <span class="variable.mut" data-binding-hash="13659994885362512323" style="color: hsl(59,80%,86%);">invalid_flags</span> = <span class="text">String</span>::<span class="text">new</span>();
        <span class="keyword.control">for</span> <span class="variable" data-binding-hash="5384859927491042818" style="color: hsl(233,43%,81%);">flag</span> <span class="keyword">in</span> <span class="variable" data-binding-hash="5908644082858828157" style="color: hsl(277,48%,78%);">flags</span> {
            <span class="macro">write</span><span class="macro">!</span>(&<span class="keyword">mut</span> invalid_flags, <span class="string">"{}, "</span>, flag)?;
        }
        <span class="keyword">let</span> (<span class="variable" data-binding-hash="6883367233668656210" style="color: hsl(132,57%,52%);">invalid_flags</span>, _) = <span class="variable.mut" data-binding-hash="6883367233668656210" style="color: hsl(132,57%,52%);">invalid_flags</span>.<span class="text">split_at</span>(<span class="variable.mut" data-binding-hash="6883367233668656210" style="color: hsl(132,57%,52%);">invalid_flags</span>.<span class="text">len</span>() - <span class="literal">2</span>);
        <span class="text">Err</span>(<span class="macro">format</span><span class="macro">!</span>(<span class="string">"Invalid flags: {}"</span>, invalid_flags).<span class="text">into</span>())
    } <span class="keyword.control">else</span> {
        <span class="text">Err</span>(<span class="variable" data-binding-hash="1056301860844129919" style="color: hsl(263,90%,50%);">e</span>.<span class="text">to_string</span>().<span class="text">into</span>())
    }
}

<span class="keyword">fn</span> <span class="function">file</span>() -&gt; <span class="type">Result</span>&lt;<span class="text">SourceFile</span>&gt; {
    <span class="keyword">let</span> <span class="variable" data-binding-hash="7785580114624222922" style="color: hsl(327,66%,40%);">text</span> = <span class="function">read_stdin</span>()?;
    <span class="text">Ok</span>(<span class="text">SourceFile</span>::<span class="text">parse</span>(&<span class="variable" data-binding-hash="7785580114624222922" style="color: hsl(327,66%,40%);">text</span>).<span class="text">tree</span>())
}

<span class="keyword">fn</span> <span class="function">read_stdin</span>() -&gt; <span class="type">Result</span>&lt;<span class="text">String</span>&gt; {
    <span class="keyword">let</span> <span class="keyword">mut</span> <span class="variable.mut" data-binding-hash="3274528523549898008" style="color: hsl(239,67%,85%);">buff</span> = <span class="text">String</span>::<span class="text">new</span>();
    <span class="text">std</span>::<span class="text">io</span>::<span class="text">stdin</span>().<span class="text">read_to_string</span>(&<span class="keyword">mut</span> <span class="variable.mut" data-binding-hash="3274528523549898008" style="color: hsl(239,67%,85%);">buff</span>)?;
    <span class="text">Ok</span>(<span class="variable.mut" data-binding-hash="3274528523549898008" style="color: hsl(239,67%,85%);">buff</span>)
}

<span class="keyword">fn</span> <span class="function">rsplit_at_char</span>(<span class="variable" data-binding-hash="17622874386840607531" style="color: hsl(261,65%,82%);">s</span>: &<span class="type">str</span>, <span class="variable" data-binding-hash="16521816906198006117" style="color: hsl(238,77%,83%);">c</span>: <span class="type">char</span>) -&gt; <span class="type">Result</span>&lt;(&<span class="type">str</span>, &<span class="type">str</span>)&gt; {
    <span class="keyword">let</span> <span class="variable" data-binding-hash="4625781186172929877" style="color: hsl(321,87%,89%);">idx</span> = <span class="variable" data-binding-hash="17622874386840607531" style="color: hsl(261,65%,82%);">s</span>.<span class="text">rfind</span>(<span class="literal">':'</span>).<span class="text">ok_or_else</span>(|| <span class="macro">format</span><span class="macro">!</span>(<span class="string">"no `{}` in {}"</span>, c, s))?;
    <span class="text">Ok</span>((&<span class="variable" data-binding-hash="17622874386840607531" style="color: hsl(261,65%,82%);">s</span>[..<span class="text">idx</span>], &<span class="variable" data-binding-hash="17622874386840607531" style="color: hsl(261,65%,82%);">s</span>[<span class="variable" data-binding-hash="4625781186172929877" style="color: hsl(321,87%,89%);">idx</span> + <span class="literal">1</span>..]))
}
</code></pre>
